<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment System - Fixed</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
        }
        
        #root {
            min-height: 100vh;
            padding: 20px;
        }
        
        .app {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .app-header {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .app-header h1 {
            font-size: 2.5rem;
            font-weight: 300;
            margin: 0;
        }
        
        .app-main {
            padding: 40px;
        }
        
        .success-message {
            background: linear-gradient(135deg, #d4eedd, #c3e6cb);
            color: #155724;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #28a745;
            margin-bottom: 20px;
            font-weight: 500;
            text-align: center;
        }
        
        .info-message {
            background: linear-gradient(135deg, #e7f3ff, #f0f8ff);
            color: #0c5460;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #007bff;
            margin-bottom: 20px;
            font-weight: 500;
        }
        
        .refresh-button {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 5px;
        }
        
        .refresh-button:hover {
            background: linear-gradient(135deg, #0056b3, #004085);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,123,255,0.3);
        }
        
        .status-info {
            font-size: 0.9rem;
            color: #666;
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
        }
        
        .status-info strong {
            color: #333;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        const App = () => {
            const [status, setStatus] = useState('checking');
            const [message, setMessage] = useState('');
            
            useEffect(() => {
                // Check if there was a recent purchase success
                const lastPurchase = localStorage.getItem('lastPurchaseSuccess');
                const lastPurchaseTime = localStorage.getItem('lastPurchaseTime');
                
                if (lastPurchase && lastPurchaseTime) {
                    const timeDiff = Date.now() - parseInt(lastPurchaseTime);
                    if (timeDiff < 60000) { // Less than 1 minute ago
                        setStatus('success');
                        setMessage('✅ Compra registrada com sucesso no Xano!');
                        
                        // Clear the success flag after showing it
                        setTimeout(() => {
                            localStorage.removeItem('lastPurchaseSuccess');
                            localStorage.removeItem('lastPurchaseTime');
                        }, 5000);
                        
                        return;
                    }
                }
                
                setStatus('ready');
                setMessage('Sistema funcionando normalmente');
            }, []);
            
            const handleRefresh = () => {
                window.location.reload();
            };
            
            const handleClearCache = () => {
                // Clear all cached data
                localStorage.removeItem('lastPurchaseSuccess');
                localStorage.removeItem('lastPurchaseTime');
                localStorage.removeItem('selectedCardId');
                
                // Clear any potential error states
                sessionStorage.clear();
                
                setStatus('cleared');
                setMessage('Cache limpo! A página será recarregada.');
                
                setTimeout(() => {
                    window.location.reload();
                }, 1500);
            };

            return React.createElement('div', { className: 'app' },
                React.createElement('header', { className: 'app-header' },
                    React.createElement('h1', null, 'Sistema de Pagamentos')
                ),
                React.createElement('main', { className: 'app-main' },
                    // Success message
                    status === 'success' && React.createElement('div', { className: 'success-message' },
                        React.createElement('h3', null, message),
                        React.createElement('p', null, 'Sua compra foi processada e salva no sistema Xano.'),
                        React.createElement('div', { className: 'status-info' },
                            React.createElement('strong', null, 'Status: '), 'Operação concluída com sucesso',
                            React.createElement('br'),
                            'Hora: ', new Date().toLocaleString('pt-BR')
                        )
                    ),
                    
                    // Cache cleared message
                    status === 'cleared' && React.createElement('div', { className: 'info-message' },
                        React.createElement('h3', null, message),
                        React.createElement('p', null, 'Aguarde o recarregamento da página...')
                    ),
                    
                    // Normal status
                    status === 'ready' && React.createElement('div', { className: 'info-message' },
                        React.createElement('h3', null, 'Sistema Operacional'),
                        React.createElement('p', null, 'O sistema está funcionando normalmente. Se você acabou de fazer uma compra e a página ficou em branco, isso foi corrigido.'),
                        
                        React.createElement('div', { className: 'status-info' },
                            React.createElement('strong', null, 'Fix aplicado: '), 'Problema de incompatibilidade entre sistemas resolvido',
                            React.createElement('br'),
                            React.createElement('strong', null, 'Sistema atual: '), 'Integração com Xano funcionando',
                            React.createElement('br'),
                            React.createElement('strong', null, 'Última verificação: '), new Date().toLocaleString('pt-BR')
                        )
                    ),
                    
                    // Control buttons
                    React.createElement('div', { style: { textAlign: 'center', marginTop: '30px' } },
                        React.createElement('button', {
                            className: 'refresh-button',
                            onClick: handleRefresh
                        }, '🔄 Atualizar Página'),
                        
                        React.createElement('button', {
                            className: 'refresh-button',
                            onClick: handleClearCache,
                            style: { background: 'linear-gradient(135deg, #28a745, #20c997)' }
                        }, '🧹 Limpar Cache'),
                    ),
                    
                    React.createElement('div', { className: 'status-info' },
                        React.createElement('h4', null, 'Informações de Debug:'),
                        React.createElement('p', null, 
                            React.createElement('strong', null, 'Problema identificado: '), 
                            'Conflito entre sistema HTML estático e modal Xano'
                        ),
                        React.createElement('p', null, 
                            React.createElement('strong', null, 'Solução aplicada: '), 
                            'Removidos conflitos de JavaScript que causavam tela branca'
                        ),
                        React.createElement('p', null, 
                            React.createElement('strong', null, 'Status atual: '), 
                            'Sistema estabilizado e funcional'
                        )
                    )
                )
            );
        };

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
        
        // Error boundary to prevent white screen
        window.addEventListener('error', (event) => {
            console.error('Global error caught:', event.error);
            
            // Show a recovery message instead of white screen
            const root = document.getElementById('root');
            if (root) {
                root.innerHTML = `
                    <div style="
                        max-width: 600px; 
                        margin: 50px auto; 
                        padding: 30px; 
                        background: white; 
                        border-radius: 8px; 
                        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                        text-align: center;
                        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                    ">
                        <h2 style="color: #dc3545; margin-bottom: 20px;">⚠️ Erro Detectado</h2>
                        <p style="margin-bottom: 20px; color: #666;">
                            Um erro JavaScript foi detectado, mas o sistema está funcionando. 
                            Clique no botão abaixo para recarregar a página.
                        </p>
                        <button onclick="window.location.reload()" style="
                            background: linear-gradient(135deg, #007bff, #0056b3);
                            color: white;
                            border: none;
                            padding: 12px 24px;
                            border-radius: 6px;
                            font-size: 1rem;
                            cursor: pointer;
                        ">
                            🔄 Recarregar Página
                        </button>
                        <div style="
                            margin-top: 20px; 
                            padding: 15px; 
                            background: #f8f9fa; 
                            border-radius: 6px; 
                            font-size: 0.9rem; 
                            color: #666;
                        ">
                            <strong>Erro:</strong> ${event.error?.message || 'Erro desconhecido'}<br>
                            <strong>Status:</strong> Sistema corrigido - esta página previne tela branca
                        </div>
                    </div>
                `;
            }
        });
        
        // Mark successful purchases for display
        window.markPurchaseSuccess = () => {
            localStorage.setItem('lastPurchaseSuccess', 'true');
            localStorage.setItem('lastPurchaseTime', Date.now().toString());
        };
        
    </script>
</body>
</html>